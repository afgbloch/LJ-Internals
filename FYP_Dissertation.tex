% --------------------------------------------------------------------------------
% Student guideline for the final year dissertation using LaTeX2e
% Alexandra Bonnici
% Department of Systems and Control
% 13th September 2017

\documentclass[12pt, oneside]{Thesis}

% --------------------------------------------------------------------------------
% Some useful packages
% You may add/remove any packages as you deem fit,
% Recommended packages which are recommended are marked by [R] in the comment
% --------------------------------------------------------------------------------

% font options & general typesetting
\usepackage{microtype}            % some refinements over the general appearance of text
\usepackage{eqparbox}             % ensures that blocks of text occupy the same space

% for figures
\usepackage[]{graphicx}     %  [R] to use graphics
\usepackage{subfigure}            %  [R] to make subfigures
\usepackage{epstopdf}             %  [R] adds eps support in the graphics package
\usepackage{wrapfig}              %  to allow text to wrap around figures


% for tables
\usepackage[table]{xcolor}
\usepackage{multirow,bigstrut}    % to have tables with merged rows
\usepackage{array, booktabs}      %  [R] for good looking tables
\usepackage{longtable}            % to create tables that span more than one page
\usepackage{adjustbox}            % so that long tables fit within the page
\usepackage{rotating}             % adds support to rotate pages

% to write nice mathematical equations
\usepackage{mathtools}            %  [R] some mathematical tools
\usepackage{amsmath}		      %  [R] to write math formulas easily
\usepackage{amssymb}              %  [R] for maths symbols
\usepackage{amsthm}               % for the typesetting of theorems
\usepackage{esvect}               % to make vector arrows
\usepackage{bm}                   % to make bold maths symbols

\usepackage{xfrac}                % [R] to make in-text fractions

% more symbols
\usepackage{pifont}               % Postscript standard Symbol and Dingbats fonts
\usepackage{gensymb}              % generic symbols fonts
\usepackage{stackrel}             % to stack things on top of each other

% to include urls
\usepackage{url}                  % to write urls

% to typeset pseudo code algorithms and source codes
\usepackage{algorithm}            % to type set algorithms as pseudo code
\usepackage{algpseudocode}        % more layout options for algorithm pseudo code
\usepackage{listings}             % to add non-formatted text e.g. source code

\usepackage{tabularx}
\usepackage{multirow}
\usepackage{todonotes}
\usepackage{adjustbox}

\definecolor{mGreen}{rgb}{0,0.6,0}
\definecolor{mGray}{rgb}{0.5,0.5,0.5}
\definecolor{mPurple}{rgb}{0.58,0,0.82}
\definecolor{backgroundColour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{LuaStyle}
{
  backgroundcolor   = \color{backgroundColour},
  commentstyle      = \color{mGreen},
  keywordstyle      = \color{magenta},
  numberstyle       = \tiny\color{mGray},
  stringstyle       = \color{mPurple},
  basicstyle        = \footnotesize,
  % breakatwhitespace = false,
  % breaklines        = true,
  captionpos        = b,
  keepspaces        = true,
  numbers           = left,
  numbersep         = 5pt,
  showspaces        = false,
  showstringspaces  = false,
  showtabs          = false,
  tabsize           = 2,
  language          = {[5.2]Lua},
}
\lstset{style=LuaStyle}

\lstdefinestyle{CStyle}{
    backgroundcolor   = \color{backgroundColour},
    commentstyle      = \color{mGreen},
    keywordstyle      = \color{magenta},
    numberstyle       = \tiny\color{mGray},
    stringstyle       = \color{mPurple},
    basicstyle        = \footnotesize,
    % breakatwhitespace = false,
    % breaklines        = true,
    captionpos        = b,
    keepspaces        = true,
    numbers           = left,
    numbersep         = 5pt,
    showspaces        = false,
    showstringspaces  = false,
    showtabs          = false,
    tabsize           = 2,
    language          = C,
}
% to typeset theorems, lemmas and definitions
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}

\newcommand{\paratitle}[1]{\underline{\textbf{\emph{#1}}}}
\newcommand{\keyword}[1]{\textcolor{red}{\emph{#1}}}
\lstnewenvironment{code}[1]
  {\noindent\lstset{style=#1Style}\adjustbox{bgcolor=backgroundColour,max width=\textwidth}\bgroup}
  {\egroup}

% --------------------------------------------------------------------------------
% Information relevant to your dissertation.
% Substitute with your own name, supervisor and title details.
%--------------------------------------------------------------------------------

\thesistitle{LuaJIT Internals \\ {\large v2.1.0-beta3 (1 May 2017)}} % title
\authors{A. \textsc{Bloch}\\ Supervised by: L. \textsc{Deniau}}	% your name
\keywords{LuaJIT, technical documentation}         	% keywords
%\department{}                						% department name
%\Udegree{}
\subject{LuaJIT Internals}
%\UNIVERSITY{}
%\faculty{Faculty of Engineering}

%\newif\ifHaveACosupervisor
% toggle the comment on the true/false lines as appropriate
%\HaveACosupervisortrue
%\HaveACosupervisorfalse

%--------------------------------------------------------------------------------
% Creates the PDF meta-data (for the electronic version of your dissertation).
% There is no need to modify this information
%--------------------------------------------------------------------------------
\hypersetup{urlcolor=blue,%
		    linkcolor=blue,%
            citecolor=blue,%
            colorlinks=true,%
            hypertexnames=true}

\hypersetup{pdftitle={\ttitle}}
\hypersetup{pdfsubject=\subjectname}
\hypersetup{pdfauthor=\authornames}
\hypersetup{pdfkeywords=\keywordnames}

%--------------------------------------------------------------------------------
% Creates the title page (typesetting is taken care of and details are as above)
%--------------------------------------------------------------------------------
\title{\ttitle}

%--------------------------------------------------------------------------------
% Creates the glossaries pages and index pages
%--------------------------------------------------------------------------------
\makeglossaries
\makeindex

%--------------------------------------------------------------------------------
% The actual start of the dissertation
%--------------------------------------------------------------------------------
\begin{document}

\frontmatter            % sets page numbers of the first few pages to roman
\setstretch{1.3}        % ensures a one-and-a-half line spacing
\fancyhead{}            % clears the headers
\rhead{\thepage}        % sets the top right header to the page number
\lhead{}                % ensures that the top left header remains empty
\pagestyle{fancy}     	% uses the "fancy" page style (adds the line at top)


%--------------------------------------------------------------------------------
% Prints out the title page
%--------------------------------------------------------------------------------
\input{./Chapters/TitlePage}

% -------------------------------------------------------------------------------
% Prints out the copyright page (you do not need to modify this)
%--------------------------------------------------------------------------------
% \clearpage
% \input{./Chapters/Copyright}

%--------------------------------------------------------------------------------
% Prints out the abstract
% You will need to change the text in the file to reflect your own abstract
%--------------------------------------------------------------------------------
\clearpage
\input{./Chapters/Abstract}

%--------------------------------------------------------------------------------
% Prints out the acknowledgements page
% You will need to change the text to reflect your own acknowledgements
%--------------------------------------------------------------------------------
\clearpage
\input{./Chapters/Acknowledgements}

%--------------------------------------------------------------------------------
% Prints out the list of contents, figures and tables
% You don't have to modify any of this
%--------------------------------------------------------------------------------
\clearpage
\pagestyle{fancy}

\lhead{\emph{Contents}}
\tableofcontents

\lhead{\emph{List of Figures}}
\listoffigures

\lhead{\emph{List of Tables}}
\listoftables

%--------------------------------------------------------------------------------
% Prints out the list of acronyms
% No changes will be necessary if used properly within text
%--------------------------------------------------------------------------------
\clearpage
\setglossarystyle{altlist}
\printglossary[type=\acronymtype, title=List of Acronyms, toctitle=List of Acronyms]

%--------------------------------------------------------------------------------
% Prints out the list of symbols
% No changes will be necessary if used properly within text, comment if not relevant
%--------------------------------------------------------------------------------

\clearpage
\setglossarystyle{list}
\printglossary[title=List of Symbols,toctitle=List of Symbols]


%--------------------------------------------------------------------------------
% Prints out the chapter contents
%--------------------------------------------------------------------------------

\mainmatter
\pagestyle{fancy}

\clearpage
\chapter{Overview}
\label{Chapt:Overview}
\lhead{Chapter \thechapter. \emph{Overview}}
\input{./Chapters/Overview}

\part{Tools}
\label{Part:Tools}

  \chapter{Verbose mode}
  \label{Chapt:Verbose}
  \lhead{Chapter \thechapter. \emph{Verbose mode}}
  \input{./Chapters/verbose}

  \chapter{Profiler}
  \label{Chapt:Profiler}
  \lhead{Chapter \thechapter. \emph{Profiler}}
  \input{./Chapters/profiler}

  \chapter{Dump mode}
  \label{Chapt:Dump-mode}
  \lhead{Chapter \thechapter. \emph{Dump mode}}
  \input{./Chapters/dump}

  \chapter{Valgrind}
  \label{Chapt:Valgrind}
  \lhead{Chapter \thechapter. \emph{Valgrind}}
  \input{./Chapters/valgrind}

\part{Virtual Machine}
\label{Part:VM}

  \chapter{Frontend}
  \label{Chapt:frontend}
  \lhead{Chapter \thechapter. \emph{Frontend}}
  \input{./Chapters/Frontend}

  \chapter{Internals}
  \label{Chapt:Internals}
  \lhead{Chapter \thechapter. \emph{Internals}}
  \input{./Chapters/Internals}

  \chapter{Bytecode interpreter}
  \label{Chapt:BI}
  \lhead{Chapter \thechapter. \emph{Bytecode interpreter}}
  \input{./Chapters/Bytecode-interpreter}

  \chapter{Library}
  \label{Chapt:Library}
  \lhead{Chapter \thechapter. \emph{Library}}
  \input{./Chapters/Library}

  \chapter{Foreign function interface}
  \label{Chapt:FFI}
  \lhead{Chapter \thechapter. \emph{Foreign function interface}}
  \input{./Chapters/FFI}

\part{JIT}
\label{Part:JIT}

  \chapter{Trace record}
  \label{Chapt:TR}
  \input{./Chapters/TR.tex}

  \chapter{Intermediate representation}
  \label{Chapt:IR}
  \input{./Chapters/IR.tex}

  \chapter{Trace manager}
  \label{Chapt:TM}
  \input{./Chapters/TM.tex}

  \chapter{Trace optimizer}
  \label{Chapt:TO}
  \input{./Chapters/TO.tex}

  \chapter{Machine code emitter}
  \label{Chapt:mcode}
%--------------------------------------------------------------------------------
% Prints out any appendices (comment/delete if you do not need any)
%--------------------------------------------------------------------------------
\clearpage
\addtocontents{toc}{\vspace{2em}}
\appendix
\baselineskip=16pt

\chapter{Files hierarchy}
\label{Apendix:files}
\lhead{Appendix \ref{Apendix:files}. \emph{Files hierarchy}}
\input{./Chapters/Files}

\chapter{Data structure}
\label{Apendix:ds}
\lhead{Appendix \ref{Apendix:ds}. \emph{Data structure}}

\chapter{Dump values}
\label{Apendix:dump-values}
\lhead{Appendix \ref{Apendix:dump-values}. \emph{Dump values}}
\input{./Chapters/Dump-values}

\chapter{Flame graphs}
\label{Apendix:fl}
\lhead{Appendix \ref{Apendix:fl}. \emph{Flame graphs}}
\input{./Chapters/Flame}

\chapter{DynASM: Assembler}
\label{Apendix:DynASM}
\lhead{Appendix \ref{Apendix:DynASM}. \emph{DynASM: Assembler}}
\input{./Chapters/DynASM}

\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics

\backmatter

%--------------------------------------------------------------------------------
% Prints out the bibliography
%--------------------------------------------------------------------------------

\label{Bibliography}

\lhead{\emph{Bibliography}}
\renewcommand{\bibname}{References}
\bibliographystyle{MyBibliographyStyle}
\bibliography{./Chapters/FYPBibliography}


\end{document}